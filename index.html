<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Mission Control ‚Äî Intuitive Agents Swarm</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéØ</text></svg>">
    <style>
/* ============================================
   MISSION CONTROL ‚Äî Intuitive Agents Swarm
   Single-file dashboard ‚Äî Dark + Neon
   ============================================ */
*{margin:0;padding:0;box-sizing:border-box}

:root{
    --bg-primary:#0a0a0f;
    --bg-secondary:#12121a;
    --bg-card:#1a1a24;
    --bg-hover:#22222e;
    --bg-glass:rgba(26,26,36,0.6);
    --text-primary:#ffffff;
    --text-secondary:#9ca3af;
    --text-muted:#6b7280;
    --accent-green:#10b981;
    --accent-blue:#3b82f6;
    --accent-purple:#8b5cf6;
    --accent-orange:#f59e0b;
    --accent-red:#ef4444;
    --accent-pink:#ec4899;
    --accent-cyan:#06b6d4;
    --accent-amber:#d97706;
    --border-color:rgba(255,255,255,0.06);
    --border-subtle:rgba(255,255,255,0.03);
    --glass-blur:blur(20px);
    --glass-border:1px solid rgba(255,255,255,0.08);
    --radius:12px;
    --radius-sm:8px;
    --radius-lg:16px;
    --transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    --shadow-lg:0 10px 25px -5px rgba(0,0,0,0.5);
}

body{
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display','Segoe UI',Roboto,sans-serif;
    background:var(--bg-primary);
    color:var(--text-primary);
    min-height:100vh;
    overflow-x:hidden;
    line-height:1.5;
}

/* ===== ANIMATED BACKGROUND ===== */
.background{position:fixed;inset:0;z-index:0;overflow:hidden}
.bg-orb{position:absolute;border-radius:50%;filter:blur(80px);opacity:0.12;animation:orbFloat 20s ease-in-out infinite}
.bg-orb-1{width:400px;height:400px;background:var(--accent-purple);top:-100px;left:-100px}
.bg-orb-2{width:350px;height:350px;background:var(--accent-blue);bottom:-50px;right:-50px;animation-delay:-7s}
.bg-orb-3{width:300px;height:300px;background:var(--accent-green);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-14s}
@keyframes orbFloat{
    0%,100%{transform:translate(0,0) scale(1)}
    33%{transform:translate(30px,-30px) scale(1.05)}
    66%{transform:translate(-20px,20px) scale(0.95)}
}
.grid-overlay{
    position:absolute;inset:0;
    background-image:linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);
    background-size:60px 60px;
}

/* ===== MAIN CONTENT ===== */
.main-content{position:relative;z-index:1;padding:16px 28px 40px;max-width:1800px;margin:0 auto}

/* ===== HEADER ===== */
.header{
    display:flex;justify-content:space-between;align-items:center;
    padding:12px 20px;margin-bottom:20px;
    background:var(--bg-glass);backdrop-filter:var(--glass-blur);
    border:var(--glass-border);border-radius:var(--radius-lg);
}
.header-left{display:flex;align-items:center;gap:12px}
.logo-icon{font-size:28px;filter:drop-shadow(0 0 8px rgba(59,130,246,0.4))}
.header h1{
    font-size:22px;font-weight:700;
    background:linear-gradient(135deg,#fff 0%,#94a3b8 100%);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.header-badge{
    font-size:10px;font-weight:700;letter-spacing:1px;padding:3px 8px;
    background:linear-gradient(135deg,var(--accent-purple),var(--accent-blue));
    border-radius:20px;color:white;text-transform:uppercase;
}
.header-center{display:flex;align-items:center}
.swarm-health{
    display:flex;align-items:center;gap:8px;padding:6px 16px;
    background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.2);border-radius:20px;
}
.swarm-health.degraded{background:rgba(245,158,11,0.1);border-color:rgba(245,158,11,0.2)}
.swarm-health.critical{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.2)}
.health-dot{
    width:8px;height:8px;border-radius:50%;
    background:var(--accent-green);box-shadow:0 0 8px var(--accent-green);
    animation:pulse 2s ease-in-out infinite;
}
.health-dot.degraded{background:var(--accent-orange);box-shadow:0 0 8px var(--accent-orange)}
.health-dot.critical{background:var(--accent-red);box-shadow:0 0 8px var(--accent-red)}
.health-label{font-size:13px;font-weight:600;color:var(--accent-green)}
.swarm-health.degraded .health-label{color:var(--accent-orange)}
.swarm-health.critical .health-label{color:var(--accent-red)}
.header-right{display:flex;align-items:center;gap:16px}
.live-clock{font-size:15px;font-weight:600;font-variant-numeric:tabular-nums;color:var(--accent-cyan);letter-spacing:0.5px}
.refresh-info{display:flex;align-items:center;gap:10px}
.last-refresh{font-size:11px;color:var(--text-muted)}
.auto-refresh-toggle{display:flex;align-items:center;gap:6px;cursor:pointer}
.auto-refresh-toggle input{display:none}
.toggle-slider{width:36px;height:20px;background:var(--bg-hover);border-radius:10px;position:relative;transition:var(--transition)}
.toggle-slider::after{content:'';position:absolute;width:16px;height:16px;border-radius:50%;background:var(--text-muted);top:2px;left:2px;transition:var(--transition)}
.auto-refresh-toggle input:checked+.toggle-slider{background:var(--accent-green)}
.auto-refresh-toggle input:checked+.toggle-slider::after{background:white;transform:translateX(16px)}
.toggle-label{font-size:11px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.btn-icon{
    width:36px;height:36px;display:flex;align-items:center;justify-content:center;
    background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-sm);
    color:var(--text-secondary);font-size:18px;cursor:pointer;transition:var(--transition);
}
.btn-icon:hover{background:var(--bg-hover);color:var(--text-primary);transform:rotate(180deg)}

/* ===== AGENT CARDS ===== */
.agent-cards-row{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:20px}
.agent-card{
    background:var(--bg-glass);backdrop-filter:var(--glass-blur);
    border:var(--glass-border);border-radius:var(--radius-lg);
    padding:20px;transition:var(--transition);position:relative;overflow:hidden;
}
.agent-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:var(--radius-lg) var(--radius-lg) 0 0}
.agent-card[data-agent="iva"]::before{background:linear-gradient(90deg,var(--accent-purple),var(--accent-blue))}
.agent-card[data-agent="ivan"]::before{background:linear-gradient(90deg,var(--accent-blue),var(--accent-cyan))}
.agent-card[data-agent="tia"]::before{background:linear-gradient(90deg,var(--accent-orange),var(--accent-red))}
.agent-card[data-agent="joy"]::before{background:linear-gradient(90deg,var(--accent-pink),var(--accent-purple))}
.agent-card[data-agent="arvis"]::before{background:linear-gradient(90deg,var(--accent-cyan),var(--accent-green))}
.agent-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);border-color:rgba(255,255,255,0.12)}
.agent-card-top{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.agent-avatar{
    width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    font-size:24px;position:relative;flex-shrink:0;
}
.agent-avatar[data-agent="iva"]{background:linear-gradient(135deg,rgba(139,92,246,0.2),rgba(59,130,246,0.2))}
.agent-avatar[data-agent="ivan"]{background:linear-gradient(135deg,rgba(59,130,246,0.2),rgba(6,182,212,0.2))}
.agent-avatar[data-agent="tia"]{background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(239,68,68,0.2))}
.agent-avatar[data-agent="joy"]{background:linear-gradient(135deg,rgba(236,72,153,0.2),rgba(139,92,246,0.2))}
.agent-avatar[data-agent="arvis"]{background:linear-gradient(135deg,rgba(6,182,212,0.2),rgba(16,185,129,0.2))}
.agent-status-dot{position:absolute;bottom:2px;right:2px;width:12px;height:12px;border-radius:50%;border:2px solid var(--bg-card)}
.agent-status-dot.online{background:var(--accent-green);box-shadow:0 0 6px var(--accent-green);animation:pulse 2s ease-in-out infinite}
.agent-status-dot.offline{background:var(--accent-red)}
.agent-status-dot.sleeping{background:var(--accent-orange);animation:sleepPulse 3s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
@keyframes sleepPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.4;transform:scale(0.8)}}
.agent-name-block{flex:1;min-width:0}
.agent-name{font-size:16px;font-weight:700;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.agent-role{font-size:11px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.agent-model-badge{font-size:10px;padding:2px 8px;border-radius:10px;font-weight:600;white-space:nowrap}
.model-opus{background:rgba(139,92,246,0.2);color:#c4b5fd}
.model-kimi{background:rgba(59,130,246,0.2);color:#93c5fd}
.model-sonnet{background:rgba(236,72,153,0.2);color:#f9a8d4}
.agent-details{display:flex;flex-direction:column;gap:8px;font-size:12px}
.agent-detail-row{display:flex;justify-content:space-between;align-items:center}
.agent-detail-label{color:var(--text-muted)}
.agent-detail-value{color:var(--text-secondary);font-weight:500}
.channel-badges{display:flex;gap:6px}
.channel-badge{font-size:10px;padding:2px 8px;border-radius:10px;font-weight:600}
.badge-telegram{background:rgba(59,130,246,0.15);color:#60a5fa}
.badge-imessage{background:rgba(16,185,129,0.15);color:#6ee7b7}
.badge-discord{background:rgba(139,92,246,0.15);color:#a78bfa}
.badge-webchat{background:rgba(6,182,212,0.15);color:#67e8f9}
.context-bar{margin-top:8px}
.context-bar-label{display:flex;justify-content:space-between;font-size:10px;color:var(--text-muted);margin-bottom:4px}
.context-bar-track{height:4px;background:rgba(255,255,255,0.05);border-radius:2px;overflow:hidden}
.context-bar-fill{height:100%;border-radius:2px;transition:width 0.5s ease}
.context-bar-fill.low{background:var(--accent-green)}
.context-bar-fill.medium{background:var(--accent-orange)}
.context-bar-fill.high{background:var(--accent-red)}
.agent-task-current{margin-top:10px;padding:8px 10px;background:rgba(255,255,255,0.03);border-radius:var(--radius-sm);border-left:3px solid var(--accent-blue)}
.agent-task-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px}
.agent-task-name{font-size:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.agent-client{margin-top:8px;font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:4px}

/* ===== SWARM STATS BAR ===== */
.swarm-stats-bar{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:20px}
.swarm-stat{
    display:flex;align-items:center;gap:12px;padding:14px 18px;
    background:var(--bg-glass);backdrop-filter:var(--glass-blur);
    border:var(--glass-border);border-radius:var(--radius);transition:var(--transition);
}
.swarm-stat:hover{transform:translateY(-2px);border-color:rgba(255,255,255,0.12)}
.swarm-stat-icon{font-size:24px;filter:grayscale(0.2)}
.swarm-stat-content{display:flex;flex-direction:column}
.swarm-stat-value{
    font-size:22px;font-weight:700;font-variant-numeric:tabular-nums;
    background:linear-gradient(135deg,#fff 0%,#94a3b8 100%);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.swarm-stat-label{font-size:11px;color:var(--text-muted);font-weight:500;text-transform:uppercase;letter-spacing:0.3px}

/* ===== MAIN GRID ===== */
.main-grid{display:grid;grid-template-columns:1fr 340px;gap:20px;margin-bottom:20px}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.section-header h2{font-size:16px;font-weight:700;color:var(--text-primary)}

/* ===== KANBAN BOARD ===== */
.kanban-section{min-width:0}
.kanban-board{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;overflow-x:auto}
.kanban-column{
    background:rgba(18,18,26,0.5);border-radius:var(--radius);padding:12px;
    min-height:300px;border:1px solid var(--border-subtle);transition:var(--transition);min-width:150px;
}
.kanban-column.drag-over{background:rgba(16,185,129,0.08);border-color:var(--accent-green)}
.column-header{display:flex;align-items:center;gap:6px;padding-bottom:10px;margin-bottom:10px;border-bottom:1px solid var(--border-subtle)}
.column-icon{font-size:14px}
.column-header h3{font-size:12px;font-weight:700;color:var(--text-primary);flex:1;text-transform:uppercase;letter-spacing:0.5px}
.task-count{background:var(--bg-hover);color:var(--text-muted);padding:1px 7px;border-radius:10px;font-size:11px;font-weight:600}
.column-tasks{display:flex;flex-direction:column;gap:8px;min-height:100px}
.task-card{
    background:var(--bg-card);border-radius:var(--radius-sm);padding:10px 12px;
    cursor:grab;border:1px solid var(--border-color);transition:var(--transition);
}
.task-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);border-color:rgba(255,255,255,0.1)}
.task-card.dragging{opacity:0.4;cursor:grabbing}
.task-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;gap:6px}
.task-title{font-size:12px;font-weight:600;color:var(--text-primary);line-height:1.3;flex:1}
.task-priority{width:7px;height:7px;border-radius:50%;flex-shrink:0;margin-top:4px}
.task-priority.low{background:var(--text-muted)}
.task-priority.medium{background:var(--accent-blue)}
.task-priority.high{background:var(--accent-orange)}
.task-priority.urgent{background:var(--accent-red);animation:pulse 1s infinite}
.task-description{font-size:11px;color:var(--text-muted);margin-bottom:8px;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.task-tags{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
.task-tag{padding:2px 7px;border-radius:8px;font-size:9px;font-weight:600;letter-spacing:0.3px}
.task-tag.ars{background:rgba(245,158,11,0.15);color:#fbbf24}
.task-tag.dev{background:rgba(59,130,246,0.15);color:#60a5fa}
.task-tag.marketing{background:rgba(236,72,153,0.15);color:#f472b6}
.task-tag.infra{background:rgba(139,92,246,0.15);color:#a78bfa}
.task-tag.personal{background:rgba(16,185,129,0.15);color:#6ee7b7}
.task-tag.crm{background:rgba(6,182,212,0.15);color:#67e8f9}
.task-tag.urgent{background:rgba(239,68,68,0.15);color:#fca5a5}
.task-tag.voice{background:rgba(217,119,6,0.15);color:#fbbf24}
.task-tag.default{background:rgba(255,255,255,0.05);color:var(--text-secondary)}
.task-meta{display:flex;justify-content:space-between;align-items:center}
.task-due{font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:3px}
.task-due.overdue{color:var(--accent-red)}
.task-due.soon{color:var(--accent-orange)}
.task-assignee-badge{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:default}

/* ===== ACTIVITY FEED ===== */
.activity-feed{
    background:var(--bg-glass);backdrop-filter:var(--glass-blur);
    border:var(--glass-border);border-radius:var(--radius-lg);
    padding:16px;max-height:600px;display:flex;flex-direction:column;
}
.feed-live-badge{font-size:10px;font-weight:700;color:var(--accent-red);letter-spacing:0.5px;animation:pulse 1.5s infinite}
.feed-list{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:2px}
.feed-item{
    padding:8px 10px;border-radius:var(--radius-sm);
    transition:background 0.2s;border-left:3px solid transparent;
    animation:feedSlideIn 0.3s ease-out;
}
@keyframes feedSlideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.feed-item:hover{background:rgba(255,255,255,0.02)}
.feed-item[data-bot="iva"]{border-left-color:var(--accent-purple)}
.feed-item[data-bot="ivan"]{border-left-color:var(--accent-blue)}
.feed-item[data-bot="tia"]{border-left-color:var(--accent-orange)}
.feed-item[data-bot="joy"]{border-left-color:var(--accent-pink)}
.feed-item[data-bot="arvis"]{border-left-color:var(--accent-cyan)}
.feed-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
.feed-bot-name{font-size:11px;font-weight:700}
.feed-bot-name[data-bot="iva"]{color:var(--accent-purple)}
.feed-bot-name[data-bot="ivan"]{color:var(--accent-blue)}
.feed-bot-name[data-bot="tia"]{color:var(--accent-orange)}
.feed-bot-name[data-bot="joy"]{color:var(--accent-pink)}
.feed-bot-name[data-bot="arvis"]{color:var(--accent-cyan)}
.feed-time{font-size:10px;color:var(--text-muted);font-variant-numeric:tabular-nums}
.feed-message{font-size:12px;color:var(--text-secondary);line-height:1.4}
.feed-type-icon{margin-right:4px}
.feed-typing{display:flex;align-items:center;gap:6px;padding:8px 10px;font-size:12px;color:var(--text-muted);font-style:italic}
.typing-dots{display:flex;gap:3px}
.typing-dots span{width:4px;height:4px;border-radius:50%;background:var(--text-muted);animation:typingBounce 1.4s ease-in-out infinite}
.typing-dots span:nth-child(2){animation-delay:0.2s}
.typing-dots span:nth-child(3){animation-delay:0.4s}
@keyframes typingBounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-4px)}}

/* ===== COLLAPSIBLE SECTIONS ===== */
.collapsible{
    background:var(--bg-glass);backdrop-filter:var(--glass-blur);
    border:var(--glass-border);border-radius:var(--radius-lg);
    padding:16px 20px;margin-bottom:16px;
}
.clickable{cursor:pointer;user-select:none}
.clickable:hover .collapse-icon{color:var(--text-primary)}
.collapse-icon{font-size:12px;color:var(--text-muted);transition:var(--transition)}
.collapsible-content{overflow:hidden;max-height:2000px;transition:max-height 0.4s ease,opacity 0.3s ease;opacity:1}
.collapsible-content.collapsed{max-height:0;opacity:0}

/* ===== NETWORK TOPOLOGY ===== */
.topology-map{padding:20px 0;display:flex;justify-content:center}
.topology-map svg{max-width:100%;height:auto}

/* ===== CRON JOBS ===== */
.cron-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px;padding-top:8px}
.cron-group{background:rgba(255,255,255,0.02);border-radius:var(--radius);padding:14px;border:1px solid var(--border-subtle)}
.cron-group-header{display:flex;align-items:center;gap:8px;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border-subtle)}
.cron-group-name{font-size:14px;font-weight:700}
.cron-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border-subtle)}
.cron-item:last-child{border-bottom:none}
.cron-item-left{display:flex;flex-direction:column;gap:2px}
.cron-name{font-size:12px;font-weight:600;color:var(--text-primary)}
.cron-schedule{font-size:10px;color:var(--text-muted);font-family:'SF Mono','Fira Code',monospace}
.cron-item-right{display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.cron-next{font-size:10px;color:var(--text-secondary)}
.cron-status-badge{font-size:9px;font-weight:700;padding:2px 8px;border-radius:8px;text-transform:uppercase;letter-spacing:0.5px}
.cron-status-badge.active{background:rgba(16,185,129,0.15);color:var(--accent-green)}
.cron-status-badge.paused{background:rgba(245,158,11,0.15);color:var(--accent-orange)}
.cron-status-badge.error{background:rgba(239,68,68,0.15);color:var(--accent-red)}

/* ===== COMMAND CENTER ===== */
.command-grid{display:flex;flex-direction:column;gap:16px;padding-top:8px}
.command-quick-actions{display:flex;flex-wrap:wrap;gap:8px}
.cmd-btn{
    padding:8px 16px;border-radius:var(--radius-sm);font-size:12px;font-weight:600;
    cursor:pointer;transition:var(--transition);border:1px solid var(--border-color);
    display:flex;align-items:center;gap:6px;
}
.cmd-btn-message{background:rgba(59,130,246,0.1);color:var(--accent-blue);border-color:rgba(59,130,246,0.2)}
.cmd-btn-message:hover{background:rgba(59,130,246,0.2);transform:translateY(-1px)}
.cmd-btn-restart{background:rgba(239,68,68,0.1);color:var(--accent-red);border-color:rgba(239,68,68,0.2)}
.cmd-btn-restart:hover{background:rgba(239,68,68,0.2);transform:translateY(-1px)}
.cmd-btn-status{background:rgba(16,185,129,0.1);color:var(--accent-green);border-color:rgba(16,185,129,0.2)}
.cmd-btn-status:hover{background:rgba(16,185,129,0.2);transform:translateY(-1px)}
.command-target-row{display:flex;gap:8px}
.command-select{
    padding:10px 14px;background:var(--bg-card);border:1px solid var(--border-color);
    border-radius:var(--radius-sm);color:var(--text-primary);font-size:13px;outline:none;min-width:140px;
}
.command-text-input{
    flex:1;padding:10px 14px;background:var(--bg-card);border:1px solid var(--border-color);
    border-radius:var(--radius-sm);color:var(--text-primary);font-size:13px;outline:none;transition:border-color 0.2s;
}
.command-text-input:focus{border-color:var(--accent-blue)}
.command-text-input::placeholder{color:var(--text-muted)}
.command-output{
    background:var(--bg-card);border:1px solid var(--border-color);border-radius:var(--radius-sm);
    padding:12px 16px;min-height:80px;max-height:200px;overflow-y:auto;
    font-family:'SF Mono','Fira Code',monospace;font-size:12px;color:var(--text-secondary);
}
.command-output-placeholder{color:var(--text-muted);font-style:italic}

/* ===== BUTTONS ===== */
.btn-primary{
    display:inline-flex;align-items:center;gap:6px;padding:10px 20px;
    background:linear-gradient(135deg,var(--accent-green),#059669);color:white;border:none;
    border-radius:var(--radius-sm);font-size:13px;font-weight:600;cursor:pointer;transition:var(--transition);
}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 0 20px rgba(16,185,129,0.15)}
.btn-primary.btn-sm{padding:6px 14px;font-size:12px}
.btn-secondary{
    padding:10px 20px;background:var(--bg-card);color:var(--text-secondary);
    border:1px solid var(--border-color);border-radius:var(--radius-sm);font-size:13px;font-weight:500;
    cursor:pointer;transition:var(--transition);
}
.btn-secondary:hover{background:var(--bg-hover);color:var(--text-primary)}
.btn-danger{
    padding:10px 20px;background:transparent;color:var(--accent-red);
    border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius-sm);font-size:13px;font-weight:500;
    cursor:pointer;transition:var(--transition);
}
.btn-danger:hover{background:var(--accent-red);color:white}

/* ===== MODAL ===== */
.modal-overlay{
    position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);
    display:flex;align-items:center;justify-content:center;z-index:1000;
    opacity:0;visibility:hidden;transition:all 0.3s ease;
}
.modal-overlay.active{opacity:1;visibility:visible}
.modal{
    background:var(--bg-secondary);border-radius:var(--radius-lg);padding:24px;
    width:90%;max-width:520px;max-height:90vh;overflow-y:auto;
    border:var(--glass-border);box-shadow:var(--shadow-lg);
    transform:translateY(20px) scale(0.95);transition:transform 0.3s ease;
}
.modal-wide{max-width:640px}
.modal-overlay.active .modal{transform:translateY(0) scale(1)}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-header h2{font-size:18px;font-weight:700}
.modal-close{background:none;border:none;color:var(--text-muted);font-size:24px;cursor:pointer;transition:color 0.2s;line-height:1}
.modal-close:hover{color:var(--text-primary)}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:12px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.3px}
.form-group input,.form-group textarea,.form-group select{
    width:100%;padding:10px 14px;background:var(--bg-card);border:1px solid var(--border-color);
    border-radius:var(--radius-sm);color:var(--text-primary);font-size:13px;outline:none;transition:border-color 0.2s;
}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--accent-green)}
.form-group input::placeholder,.form-group textarea::placeholder{color:var(--text-muted)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.modal-actions{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border-color)}
.modal-actions-right{display:flex;gap:10px}
.detail-field{margin-bottom:14px}
.detail-field-label{font-size:11px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px}
.detail-field-value{font-size:14px;color:var(--text-secondary);line-height:1.5}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,0.15)}

/* ===== RESPONSIVE ===== */
@media(max-width:1400px){
    .agent-cards-row{grid-template-columns:repeat(3,1fr)}
    .kanban-board{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:1100px){
    .main-grid{grid-template-columns:1fr}
    .activity-feed{max-height:400px}
    .swarm-stats-bar{grid-template-columns:repeat(3,1fr)}
    .agent-cards-row{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:768px){
    .main-content{padding:12px 16px 30px}
    .header{flex-wrap:wrap;gap:10px;padding:12px}
    .header-center{order:3;width:100%;justify-content:center}
    .agent-cards-row{grid-template-columns:1fr}
    .kanban-board{grid-template-columns:1fr}
    .swarm-stats-bar{grid-template-columns:1fr 1fr}
    .form-row{grid-template-columns:1fr}
}
    </style>
</head>
<body>
    <div class="app">
        <!-- Animated Background -->
        <div class="background">
            <div class="bg-orb bg-orb-1"></div>
            <div class="bg-orb bg-orb-2"></div>
            <div class="bg-orb bg-orb-3"></div>
            <div class="grid-overlay"></div>
        </div>

        <div class="main-content">

            <!-- ===== HEADER BAR ===== -->
            <header class="header">
                <div class="header-left">
                    <span class="logo-icon">üéØ</span>
                    <h1>Mission Control</h1>
                    <span class="header-badge">SWARM v2.0</span>
                </div>
                <div class="header-center">
                    <div class="swarm-health" id="swarm-health">
                        <span class="health-dot online"></span>
                        <span class="health-label">Swarm Healthy</span>
                    </div>
                </div>
                <div class="header-right">
                    <div class="live-clock" id="live-clock">--:--:-- PST</div>
                    <div class="refresh-info">
                        <span class="last-refresh" id="last-refresh">Last refresh: --</span>
                        <label class="auto-refresh-toggle">
                            <input type="checkbox" id="auto-refresh" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Auto</span>
                        </label>
                    </div>
                    <button class="btn-icon" id="refresh-btn" title="Refresh Now">‚ü≥</button>
                </div>
            </header>

            <!-- ===== AGENT CARDS ===== -->
            <section class="agent-cards-row" id="agent-cards"></section>

            <!-- ===== SWARM STATS BAR ===== -->
            <section class="swarm-stats-bar">
                <div class="swarm-stat">
                    <div class="swarm-stat-icon">ü§ñ</div>
                    <div class="swarm-stat-content">
                        <span class="swarm-stat-value" id="stat-agents">0</span>
                        <span class="swarm-stat-label">Total Agents</span>
                    </div>
                </div>
                <div class="swarm-stat">
                    <div class="swarm-stat-icon">üí¨</div>
                    <div class="swarm-stat-content">
                        <span class="swarm-stat-value" id="stat-sessions">0</span>
                        <span class="swarm-stat-label">Active Sessions</span>
                    </div>
                </div>
                <div class="swarm-stat">
                    <div class="swarm-stat-icon">‚¨ÜÔ∏è</div>
                    <div class="swarm-stat-content">
                        <span class="swarm-stat-value" id="stat-uptime">0%</span>
                        <span class="swarm-stat-label">Avg Uptime</span>
                    </div>
                </div>
                <div class="swarm-stat">
                    <div class="swarm-stat-icon">üî§</div>
                    <div class="swarm-stat-content">
                        <span class="swarm-stat-value" id="stat-tokens">0</span>
                        <span class="swarm-stat-label">Tokens Today</span>
                    </div>
                </div>
                <div class="swarm-stat">
                    <div class="swarm-stat-icon">üí∞</div>
                    <div class="swarm-stat-content">
                        <span class="swarm-stat-value" id="stat-cost">$0.00</span>
                        <span class="swarm-stat-label">Est. Cost Today</span>
                    </div>
                </div>
            </section>

            <!-- ===== MAIN GRID: Kanban + Activity ===== -->
            <div class="main-grid">
                <section class="kanban-section">
                    <div class="section-header">
                        <h2>üìã Task Board</h2>
                        <button class="btn-primary btn-sm" id="new-task-btn"><span>+</span> New Task</button>
                    </div>
                    <div class="kanban-board" id="kanban-board">
                        <div class="kanban-column" data-status="todo">
                            <div class="column-header"><span class="column-icon">üì•</span><h3>To Do</h3><span class="task-count" data-count="todo">0</span></div>
                            <div class="column-tasks" data-status="todo"></div>
                        </div>
                        <div class="kanban-column" data-status="in-progress">
                            <div class="column-header"><span class="column-icon">‚ö°</span><h3>In Progress</h3><span class="task-count" data-count="in-progress">0</span></div>
                            <div class="column-tasks" data-status="in-progress"></div>
                        </div>
                        <div class="kanban-column" data-status="review">
                            <div class="column-header"><span class="column-icon">üëÄ</span><h3>Review</h3><span class="task-count" data-count="review">0</span></div>
                            <div class="column-tasks" data-status="review"></div>
                        </div>
                        <div class="kanban-column" data-status="complete">
                            <div class="column-header"><span class="column-icon">‚úÖ</span><h3>Complete</h3><span class="task-count" data-count="complete">0</span></div>
                            <div class="column-tasks" data-status="complete"></div>
                        </div>
                    </div>
                </section>

                <aside class="activity-feed" id="activity-feed">
                    <div class="section-header">
                        <h2>üì° Activity Feed</h2>
                        <span class="feed-live-badge">‚óè LIVE</span>
                    </div>
                    <div class="feed-list" id="feed-list"></div>
                </aside>
            </div>

            <!-- ===== NETWORK TOPOLOGY ===== -->
            <section class="collapsible" id="network-section">
                <div class="section-header clickable" data-toggle="network-content">
                    <h2>üåê Network Topology</h2>
                    <span class="collapse-icon">‚ñº</span>
                </div>
                <div class="collapsible-content" id="network-content">
                    <div class="topology-map" id="topology-map"></div>
                </div>
            </section>

            <!-- ===== CRON JOBS ===== -->
            <section class="collapsible" id="cron-section">
                <div class="section-header clickable" data-toggle="cron-content">
                    <h2>‚è∞ Scheduled Jobs</h2>
                    <span class="collapse-icon">‚ñº</span>
                </div>
                <div class="collapsible-content" id="cron-content">
                    <div class="cron-grid" id="cron-grid"></div>
                </div>
            </section>

            <!-- ===== COMMAND CENTER ===== -->
            <section class="collapsible" id="command-section">
                <div class="section-header clickable" data-toggle="command-content">
                    <h2>üñ•Ô∏è Command Center</h2>
                    <span class="collapse-icon">‚ñº</span>
                </div>
                <div class="collapsible-content" id="command-content">
                    <div class="command-grid">
                        <div class="command-quick-actions" id="command-quick-actions"></div>
                        <div class="command-input-area">
                            <div class="command-target-row">
                                <select id="command-target" class="command-select">
                                    <option value="iva">ü¶πüèª‚Äç‚ôÄÔ∏è Iva</option>
                                    <option value="ivan">ü§ñ IVAN</option>
                                    <option value="tia">üè† T.I.A.</option>
                                    <option value="joy">‚ú® JOY</option>
                                    <option value="arvis">üîÆ ARVIS</option>
                                </select>
                                <input type="text" id="command-input" class="command-text-input" placeholder="Send a command to the selected agent...">
                                <button class="btn-primary btn-sm" id="command-send">Send ‚èé</button>
                            </div>
                            <div class="command-output" id="command-output">
                                <div class="command-output-placeholder">Command output will appear here...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- ===== NEW TASK MODAL ===== -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>New Task</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label for="task-title">Title</label>
                    <input type="text" id="task-title" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Description</label>
                    <textarea id="task-description" placeholder="Add details..." rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-assignee">Assignee</label>
                        <select id="task-assignee">
                            <option value="iva">ü¶πüèª‚Äç‚ôÄÔ∏è Iva</option>
                            <option value="ivan">ü§ñ IVAN</option>
                            <option value="tia">üè† T.I.A.</option>
                            <option value="joy">‚ú® JOY</option>
                            <option value="arvis">üîÆ ARVIS</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-priority-input">Priority</label>
                        <select id="task-priority-input">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="task-status-input">Status</label>
                        <select id="task-status-input">
                            <option value="todo" selected>To Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="review">Review</option>
                            <option value="complete">Complete</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-due-input">Due Date</label>
                        <input type="date" id="task-due-input">
                    </div>
                </div>
                <div class="form-group">
                    <label for="task-tags-input">Tags (comma-separated)</label>
                    <input type="text" id="task-tags-input" placeholder="e.g., ars, marketing, dev">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancel-btn">Cancel</button>
                    <div class="modal-actions-right">
                        <button type="submit" class="btn-primary">Create Task</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- ===== TASK DETAIL MODAL ===== -->
    <div class="modal-overlay" id="detail-modal-overlay">
        <div class="modal modal-wide">
            <div class="modal-header">
                <h2 id="detail-title">Task Detail</h2>
                <button class="modal-close" id="detail-modal-close">&times;</button>
            </div>
            <div id="detail-body"></div>
            <div class="modal-actions">
                <button type="button" class="btn-danger" id="detail-delete-btn">Delete</button>
                <div class="modal-actions-right">
                    <button type="button" class="btn-secondary" id="detail-close-btn">Close</button>
                </div>
            </div>
        </div>
    </div>

<script>
/* ============================================
   MISSION CONTROL ‚Äî Intuitive Agents Swarm
   v2.0 ‚Äî All 5 Agents
   ============================================ */

// ===== AGENT DEFINITIONS =====
const BOTS = {
    iva: {
        id: 'iva', name: 'Iva', emoji: 'ü¶πüèª‚Äç‚ôÄÔ∏è', role: "Nick's AGI Copilot",
        host: 'localhost:18789', hostLabel: 'üñ• Mac mini (local)', hostType: 'local',
        model: 'Claude Opus 4.5', modelClass: 'model-opus',
        channels: [{ name: 'Telegram', cls: 'badge-telegram' }, { name: 'iMessage', cls: 'badge-imessage' }],
        client: 'Nick ‚Äî Intuitive Labs CEO',
        color: '#8b5cf6'
    },
    ivan: {
        id: 'ivan', name: 'IVAN', emoji: 'ü§ñ', role: 'Dev Squad Lead',
        host: '137.184.6.184:18789', hostLabel: '‚òÅÔ∏è DO Droplet', hostType: 'cloud',
        model: 'Kimi K2.5', modelClass: 'model-kimi',
        channels: [{ name: 'Telegram', cls: 'badge-telegram' }],
        client: 'Intuitive Labs Team',
        color: '#3b82f6'
    },
    tia: {
        id: 'tia', name: 'T.I.A.', emoji: 'üè†', role: 'ARS Operations Bot',
        host: '137.184.6.184:18790', hostLabel: '‚òÅÔ∏è DO Droplet', hostType: 'cloud',
        model: 'Kimi K2.5', modelClass: 'model-kimi',
        channels: [{ name: 'Telegram', cls: 'badge-telegram' }],
        client: 'Trenton ‚Äî Arrow Roofing',
        color: '#f59e0b'
    },
    joy: {
        id: 'joy', name: 'JOY', emoji: '‚ú®', role: "Mom's Personal Assistant",
        host: 'localhost:18795', hostLabel: 'üñ• Mac mini (local)', hostType: 'local',
        model: 'Kimi K2.5', modelClass: 'model-kimi',
        channels: [{ name: 'iMessage', cls: 'badge-imessage' }],
        client: 'Gina Corbin',
        color: '#ec4899'
    },
    arvis: {
        id: 'arvis', name: 'ARVIS', emoji: 'üîÆ', role: 'Voice & Research Agent',
        host: '137.184.6.184:18794', hostLabel: '‚òÅÔ∏è DO Droplet', hostType: 'cloud',
        model: 'Claude Sonnet 4', modelClass: 'model-sonnet',
        channels: [{ name: 'Webchat', cls: 'badge-webchat' }, { name: 'Discord', cls: 'badge-discord' }],
        client: 'Intuitive Labs R&D',
        color: '#06b6d4'
    }
};

// ===== DEMO STATE =====
const now = new Date();
function minutesAgo(m) { return new Date(now - m * 60000).toISOString(); }
function hoursAgo(h) { return new Date(now - h * 3600000).toISOString(); }

let swarmState = {
    timestamp: now.toISOString(),
    agents: {
        iva: {
            status: 'online', sessions: 3, tokensToday: 487200,
            contextUsed: 68000, contextMax: 200000,
            lastHeartbeat: minutesAgo(2),
            currentTask: 'Building Mission Control v2 dashboard',
            costToday: 14.62, messagesToday: 47, uptime: 99.8
        },
        ivan: {
            status: 'online', sessions: 1, tokensToday: 125800,
            contextUsed: 34000, contextMax: 128000,
            lastHeartbeat: minutesAgo(5),
            currentTask: 'Monitoring dev squad channels',
            costToday: 1.89, messagesToday: 18, uptime: 97.2
        },
        tia: {
            status: 'sleeping', sessions: 0, tokensToday: 52400,
            contextUsed: 12000, contextMax: 128000,
            lastHeartbeat: minutesAgo(45),
            currentTask: null,
            costToday: 0.79, messagesToday: 8, uptime: 95.1
        },
        joy: {
            status: 'online', sessions: 1, tokensToday: 31200,
            contextUsed: 8500, contextMax: 128000,
            lastHeartbeat: minutesAgo(12),
            currentTask: 'Answering recipe question',
            costToday: 0.47, messagesToday: 12, uptime: 98.5
        },
        arvis: {
            status: 'online', sessions: 2, tokensToday: 89400,
            contextUsed: 42000, contextMax: 200000,
            lastHeartbeat: minutesAgo(3),
            currentTask: 'Deep research: competitor analysis',
            costToday: 3.21, messagesToday: 24, uptime: 96.8
        }
    }
};

// ===== DEMO TASKS =====
let tasks = [
    { id: 't1', title: 'Deploy Mission Control v2 to Cloudflare Pages', description: 'Build and deploy the new single-file swarm dashboard with all 5 agents.', assignee: 'iva', priority: 'high', status: 'in-progress', tags: ['infra', 'dev'], due: '2026-02-02' },
    { id: 't2', title: 'AccuLynx CRM sync ‚Äî weekly leads report', description: 'Pull latest leads from AccuLynx API and generate the weekly summary for Trenton.', assignee: 'tia', priority: 'medium', status: 'todo', tags: ['ars', 'crm'], due: '2026-02-03' },
    { id: 't3', title: 'Set up GoHighLevel automation for ARS', description: 'Configure 3 new email workflows in GHL for lead nurture sequences.', assignee: 'tia', priority: 'high', status: 'in-progress', tags: ['ars', 'marketing'], due: '2026-02-04' },
    { id: 't4', title: 'Review ClickUp task backlog', description: 'Go through Intuitive Labs ClickUp workspace and update stale tasks.', assignee: 'ivan', priority: 'low', status: 'todo', tags: ['dev'], due: '2026-02-05' },
    { id: 't5', title: "Gina's grocery list ‚Äî weekly prep", description: "Help Gina organize her weekly grocery list and meal plan.", assignee: 'joy', priority: 'medium', status: 'complete', tags: ['personal'], due: '2026-02-01' },
    { id: 't6', title: 'Fix BlueBubbles tunnel reconnection', description: 'Cloudflare tunnel URL changes on restart ‚Äî need persistent solution or auto-update.', assignee: 'iva', priority: 'urgent', status: 'todo', tags: ['infra', 'urgent'], due: '2026-02-02' },
    { id: 't7', title: 'Notion prompt library ‚Äî add 10 new prompts', description: 'Curate and add new high-quality prompts to the Notion Prompt Library.', assignee: 'iva', priority: 'low', status: 'todo', tags: ['dev'], due: '2026-02-07' },
    { id: 't8', title: 'ARS roof inspection follow-ups', description: 'Send follow-up messages to 5 pending inspection leads in AccuLynx.', assignee: 'tia', priority: 'high', status: 'review', tags: ['ars', 'crm'], due: '2026-02-02' },
    { id: 't9', title: 'IVAN onboarding docs', description: 'Write documentation for how IVAN handles dev squad requests and Telegram routing.', assignee: 'ivan', priority: 'medium', status: 'in-progress', tags: ['dev'], due: '2026-02-06' },
    { id: 't10', title: "Doctor appointment reminder for Gina", description: "Set up recurring reminder for Gina's Thursday appointments.", assignee: 'joy', priority: 'medium', status: 'complete', tags: ['personal'], due: '2026-02-01' },
    { id: 't11', title: 'Competitor landscape deep dive', description: 'Research top 10 AI agent platforms, compile comparison matrix with pricing.', assignee: 'arvis', priority: 'high', status: 'in-progress', tags: ['dev'], due: '2026-02-04' },
    { id: 't12', title: 'Voice agent prototype ‚Äî Retell AI', description: 'Build and test a Retell AI voice agent for ARS inbound calls.', assignee: 'arvis', priority: 'medium', status: 'review', tags: ['voice', 'ars'], due: '2026-02-05' },
    { id: 't13', title: 'Swarm cost optimization analysis', description: 'Analyze token usage across all 5 agents and find cost reduction opportunities.', assignee: 'iva', priority: 'medium', status: 'todo', tags: ['infra'], due: '2026-02-08' },
    { id: 't14', title: 'ARVIS Discord integration', description: 'Wire up ARVIS to the Intuitive Labs Discord server for research queries.', assignee: 'arvis', priority: 'medium', status: 'todo', tags: ['infra', 'dev'], due: '2026-02-06' },
];

// ===== DEMO ACTIVITY FEED =====
let activityFeed = [
    { bot: 'iva', type: 'task', message: '‚ö° Started building Mission Control v2 dashboard', time: minutesAgo(1) },
    { bot: 'arvis', type: 'task', message: 'üîç Deep research session: competitor analysis in progress', time: minutesAgo(2) },
    { bot: 'joy', type: 'message', message: 'üí¨ Sent recipe recommendations to Gina via iMessage', time: minutesAgo(4) },
    { bot: 'arvis', type: 'message', message: 'üí¨ Responded to Discord research query from Nick', time: minutesAgo(6) },
    { bot: 'iva', type: 'heartbeat', message: 'üíì Heartbeat OK ‚Äî checked email, calendar clear', time: minutesAgo(8) },
    { bot: 'ivan', type: 'message', message: 'üí¨ Responded to dev squad question in Telegram', time: minutesAgo(12) },
    { bot: 'tia', type: 'cron', message: '‚è∞ Cron: ARS daily lead check ‚Äî 3 new leads found', time: minutesAgo(18) },
    { bot: 'arvis', type: 'heartbeat', message: 'üíì Heartbeat OK ‚Äî 2 research sessions active', time: minutesAgo(20) },
    { bot: 'joy', type: 'heartbeat', message: 'üíì Heartbeat OK ‚Äî no new iMessages', time: minutesAgo(22) },
    { bot: 'iva', type: 'task', message: 'üìã Updated: Fix BlueBubbles tunnel ‚Üí blocked', time: minutesAgo(28) },
    { bot: 'ivan', type: 'heartbeat', message: 'üíì Heartbeat OK ‚Äî monitoring channels', time: minutesAgo(32) },
    { bot: 'tia', type: 'message', message: 'üí¨ Sent follow-up to lead #2847 via Telegram', time: minutesAgo(38) },
    { bot: 'arvis', type: 'task', message: 'üìã Submitted voice agent prototype for review', time: minutesAgo(40) },
    { bot: 'iva', type: 'error', message: '‚ö†Ô∏è BlueBubbles connection timeout ‚Äî tunnel URL changed', time: minutesAgo(42) },
    { bot: 'joy', type: 'message', message: 'üí¨ Helped Gina with grocery list organization', time: minutesAgo(48) },
    { bot: 'ivan', type: 'cron', message: '‚è∞ Cron: ClickUp status sync ‚Äî 0 changes', time: minutesAgo(55) },
    { bot: 'tia', type: 'heartbeat', message: 'üíì Heartbeat OK ‚Äî entering sleep mode', time: minutesAgo(62) },
    { bot: 'iva', type: 'message', message: 'üí¨ Sent daily summary to Nick via Telegram', time: hoursAgo(1.5) },
    { bot: 'arvis', type: 'cron', message: '‚è∞ Cron: Research digest compiled ‚Äî 4 articles', time: hoursAgo(1.8) },
    { bot: 'joy', type: 'cron', message: '‚è∞ Cron: Morning check-in with Gina', time: hoursAgo(2) },
    { bot: 'ivan', type: 'task', message: 'üìã Completed: Dev squad standup notes compiled', time: hoursAgo(2.5) },
    { bot: 'tia', type: 'message', message: 'üí¨ Sent roof inspection quote to client', time: hoursAgo(3) },
    { bot: 'arvis', type: 'message', message: 'üí¨ Published research summary to Discord', time: hoursAgo(3.2) },
    { bot: 'iva', type: 'cron', message: '‚è∞ Cron: Email inbox check ‚Äî 2 new messages', time: hoursAgo(3.5) },
];

// ===== DEMO CRON JOBS =====
const cronJobs = [
    { bot: 'iva', name: 'Email Inbox Check', schedule: '*/30 * * * *', next: 'In 18 min', lastResult: 'OK ‚Äî 2 new', status: 'active' },
    { bot: 'iva', name: 'Heartbeat Poll', schedule: '*/15 * * * *', next: 'In 7 min', lastResult: 'OK', status: 'active' },
    { bot: 'iva', name: 'Memory Maintenance', schedule: '0 3 * * *', next: 'Tomorrow 3:00 AM', lastResult: 'OK ‚Äî MEMORY.md updated', status: 'active' },
    { bot: 'iva', name: 'Daily Summary to Nick', schedule: '0 22 * * *', next: 'Today 10:00 PM', lastResult: 'Sent', status: 'active' },
    { bot: 'ivan', name: 'ClickUp Sync', schedule: '0 */2 * * *', next: 'In 45 min', lastResult: 'OK ‚Äî 0 changes', status: 'active' },
    { bot: 'ivan', name: 'Heartbeat Poll', schedule: '*/20 * * * *', next: 'In 3 min', lastResult: 'OK', status: 'active' },
    { bot: 'ivan', name: 'Dev Squad Standup', schedule: '0 9 * * 1-5', next: 'Monday 9:00 AM', lastResult: 'Notes compiled', status: 'active' },
    { bot: 'tia', name: 'ARS Daily Lead Check', schedule: '0 9 * * 1-5', next: 'Monday 9:00 AM', lastResult: '3 new leads', status: 'active' },
    { bot: 'tia', name: 'Weekly Report', schedule: '0 17 * * 5', next: 'Friday 5:00 PM', lastResult: 'Sent to Trenton', status: 'active' },
    { bot: 'tia', name: 'GHL Workflow Monitor', schedule: '0 */4 * * *', next: 'In 2h', lastResult: 'All OK', status: 'paused' },
    { bot: 'joy', name: 'Morning Check-in', schedule: '0 8 * * *', next: 'Tomorrow 8:00 AM', lastResult: 'Sent to Gina', status: 'active' },
    { bot: 'joy', name: 'Appointment Reminders', schedule: '0 7 * * 4', next: 'Thursday 7:00 AM', lastResult: 'Reminder sent', status: 'active' },
    { bot: 'joy', name: 'Heartbeat Poll', schedule: '*/30 * * * *', next: 'In 12 min', lastResult: 'OK', status: 'active' },
    { bot: 'arvis', name: 'Research Digest', schedule: '0 */6 * * *', next: 'In 4h', lastResult: '4 articles compiled', status: 'active' },
    { bot: 'arvis', name: 'Heartbeat Poll', schedule: '*/15 * * * *', next: 'In 8 min', lastResult: 'OK', status: 'active' },
    { bot: 'arvis', name: 'Voice Agent Health Check', schedule: '0 */3 * * *', next: 'In 1h', lastResult: 'Retell API OK', status: 'active' },
];

// ===== CLOCK =====
function updateClock() {
    const n = new Date();
    const opts = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, timeZone: 'America/Los_Angeles' };
    document.getElementById('live-clock').textContent = n.toLocaleTimeString('en-US', opts) + ' PST';
}
setInterval(updateClock, 1000);
updateClock();

// ===== AUTO REFRESH =====
let autoRefreshInterval = null;
function startAutoRefresh() { if (autoRefreshInterval) clearInterval(autoRefreshInterval); autoRefreshInterval = setInterval(refreshDashboard, 30000); }
function stopAutoRefresh() { if (autoRefreshInterval) { clearInterval(autoRefreshInterval); autoRefreshInterval = null; } }
document.getElementById('auto-refresh').addEventListener('change', (e) => { e.target.checked ? startAutoRefresh() : stopAutoRefresh(); });
document.getElementById('refresh-btn').addEventListener('click', refreshDashboard);

function refreshDashboard() {
    renderAll();
    const n = new Date();
    document.getElementById('last-refresh').textContent = 'Last refresh: ' + n.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true, timeZone: 'America/Los_Angeles' });
}

// ===== RENDER ALL =====
function renderAll() {
    renderAgentCards();
    renderSwarmStats();
    renderKanban();
    renderActivityFeed();
    renderNetworkTopology();
    renderCronJobs();
    renderCommandCenter();
    updateSwarmHealth();
}

// ===== AGENT CARDS =====
function renderAgentCards() {
    const container = document.getElementById('agent-cards');
    container.innerHTML = '';
    for (const [id, bot] of Object.entries(BOTS)) {
        const state = swarmState.agents[id] || {};
        const ctxPct = state.contextMax ? Math.round((state.contextUsed / state.contextMax) * 100) : 0;
        const ctxLevel = ctxPct < 50 ? 'low' : ctxPct < 80 ? 'medium' : 'high';
        const heartbeatTime = state.lastHeartbeat ? formatTimeAgo(state.lastHeartbeat) : '--';
        const card = document.createElement('div');
        card.className = 'agent-card';
        card.dataset.agent = id;
        card.innerHTML = `
            <div class="agent-card-top">
                <div class="agent-avatar" data-agent="${id}">
                    ${bot.emoji}
                    <div class="agent-status-dot ${state.status || 'offline'}"></div>
                </div>
                <div class="agent-name-block">
                    <div class="agent-name">${bot.name}</div>
                    <div class="agent-role">${bot.role}</div>
                </div>
                <span class="agent-model-badge ${bot.modelClass}">${bot.model}</span>
            </div>
            <div class="agent-details">
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Host</span>
                    <span class="agent-detail-value">${bot.hostLabel}</span>
                </div>
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Port</span>
                    <span class="agent-detail-value" style="font-family:'SF Mono','Fira Code',monospace;font-size:11px">${bot.host}</span>
                </div>
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Channels</span>
                    <div class="channel-badges">
                        ${bot.channels.map(c => `<span class="channel-badge ${c.cls}">${c.name}</span>`).join('')}
                    </div>
                </div>
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Sessions</span>
                    <span class="agent-detail-value">${state.sessions ?? 0}</span>
                </div>
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Uptime</span>
                    <span class="agent-detail-value">${state.uptime ? state.uptime + '%' : '--'}</span>
                </div>
                <div class="agent-detail-row">
                    <span class="agent-detail-label">Last Activity</span>
                    <span class="agent-detail-value">${heartbeatTime}</span>
                </div>
            </div>
            <div class="context-bar">
                <div class="context-bar-label">
                    <span>Context Window</span>
                    <span>${formatTokens(state.contextUsed || 0)} / ${formatTokens(state.contextMax || 0)}</span>
                </div>
                <div class="context-bar-track">
                    <div class="context-bar-fill ${ctxLevel}" style="width:${ctxPct}%"></div>
                </div>
            </div>
            ${state.currentTask ? `
            <div class="agent-task-current">
                <div class="agent-task-label">Current Task</div>
                <div class="agent-task-name">${state.currentTask}</div>
            </div>` : ''}
            <div class="agent-client">üë§ ${bot.client}</div>
        `;
        container.appendChild(card);
    }
}

// ===== SWARM STATS =====
function renderSwarmStats() {
    const agents = swarmState.agents;
    let totalSessions = 0, totalTokens = 0, totalCost = 0, totalUptime = 0;
    let botCount = 0;
    for (const a of Object.values(agents)) {
        totalSessions += a.sessions || 0;
        totalTokens += a.tokensToday || 0;
        totalCost += a.costToday || 0;
        totalUptime += a.uptime || 0;
        botCount++;
    }
    document.getElementById('stat-agents').textContent = botCount;
    document.getElementById('stat-sessions').textContent = totalSessions;
    document.getElementById('stat-uptime').textContent = (totalUptime / (botCount || 1)).toFixed(1) + '%';
    document.getElementById('stat-tokens').textContent = formatTokens(totalTokens);
    document.getElementById('stat-cost').textContent = '$' + totalCost.toFixed(2);
}

// ===== KANBAN =====
function renderKanban() {
    const statuses = ['todo', 'in-progress', 'review', 'complete'];
    for (const status of statuses) {
        const container = document.querySelector(`.column-tasks[data-status="${status}"]`);
        const countEl = document.querySelector(`.task-count[data-count="${status}"]`);
        if (!container) continue;
        container.innerHTML = '';
        const filtered = tasks.filter(t => t.status === status);
        countEl.textContent = filtered.length;
        for (const task of filtered) {
            const bot = BOTS[task.assignee];
            const card = document.createElement('div');
            card.className = 'task-card';
            card.draggable = true;
            card.dataset.taskId = task.id;
            const dueClass = getDueClass(task.due);
            card.innerHTML = `
                <div class="task-card-header">
                    <span class="task-title">${task.title}</span>
                    <span class="task-priority ${task.priority}"></span>
                </div>
                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                <div class="task-tags">
                    ${task.tags.map(t => `<span class="task-tag ${getTagClass(t)}">${t}</span>`).join('')}
                </div>
                <div class="task-meta">
                    ${task.due ? `<span class="task-due ${dueClass}">üìÖ ${formatDate(task.due)}</span>` : '<span></span>'}
                    <span class="task-assignee-badge" title="${bot ? bot.name : ''}">${bot ? bot.emoji : '?'}</span>
                </div>
            `;
            card.addEventListener('click', (e) => { if (!e.target.closest('.task-priority')) showTaskDetail(task); });
            card.addEventListener('dragstart', (e) => { card.classList.add('dragging'); e.dataTransfer.setData('text/plain', task.id); e.dataTransfer.effectAllowed = 'move'; });
            card.addEventListener('dragend', () => card.classList.remove('dragging'));
            container.appendChild(card);
        }
    }
    document.querySelectorAll('.kanban-column').forEach(col => {
        col.addEventListener('dragover', (e) => { e.preventDefault(); col.classList.add('drag-over'); });
        col.addEventListener('dragleave', () => col.classList.remove('drag-over'));
        col.addEventListener('drop', (e) => {
            e.preventDefault(); col.classList.remove('drag-over');
            const taskId = e.dataTransfer.getData('text/plain');
            const newStatus = col.dataset.status;
            const task = tasks.find(t => t.id === taskId);
            if (task && task.status !== newStatus) {
                task.status = newStatus;
                renderKanban();
                addActivityEntry(task.assignee || 'iva', 'task', `üìã Moved "${task.title}" ‚Üí ${capitalize(newStatus)}`);
            }
        });
    });
}

// ===== ACTIVITY FEED =====
function renderActivityFeed() {
    const list = document.getElementById('feed-list');
    list.innerHTML = '';
    const typingBots = Object.entries(swarmState.agents)
        .filter(([, a]) => a.status === 'online' && a.currentTask)
        .slice(0, 2);
    for (const [id] of typingBots) {
        const bot = BOTS[id];
        const typing = document.createElement('div');
        typing.className = 'feed-typing';
        typing.innerHTML = `${bot.emoji} ${bot.name} is working... <div class="typing-dots"><span></span><span></span><span></span></div>`;
        list.appendChild(typing);
    }
    for (const item of activityFeed.slice(0, 50)) {
        const el = document.createElement('div');
        el.className = 'feed-item';
        el.dataset.bot = item.bot;
        const typeIcon = { heartbeat: 'üíì', message: 'üí¨', task: 'üìã', cron: '‚è∞', error: '‚ö†Ô∏è' }[item.type] || 'üìå';
        el.innerHTML = `
            <div class="feed-item-header">
                <span class="feed-bot-name" data-bot="${item.bot}">${BOTS[item.bot]?.emoji || ''} ${BOTS[item.bot]?.name || item.bot}</span>
                <span class="feed-time">${formatTimeAgo(item.time)}</span>
            </div>
            <div class="feed-message"><span class="feed-type-icon">${typeIcon}</span>${item.message.replace(/^[^\s]+\s/, '')}</div>
        `;
        list.appendChild(el);
    }
}

function addActivityEntry(bot, type, message) {
    activityFeed.unshift({ bot, type, message, time: new Date().toISOString() });
    if (activityFeed.length > 100) activityFeed.pop();
    renderActivityFeed();
}

// ===== NETWORK TOPOLOGY =====
function renderNetworkTopology() {
    const container = document.getElementById('topology-map');
    const sc = (id) => {
        const s = swarmState.agents[id]?.status || 'offline';
        return s === 'online' ? '#10b981' : s === 'sleeping' ? '#f59e0b' : '#ef4444';
    };
    const anim = (id) => {
        const s = swarmState.agents[id]?.status || 'offline';
        if (s === 'online') return '<animate attributeName="opacity" values="1;0.4;1" dur="2s" repeatCount="indefinite"/>';
        if (s === 'sleeping') return '<animate attributeName="opacity" values="1;0.3;1" dur="3s" repeatCount="indefinite"/>';
        return '';
    };

    container.innerHTML = `
    <svg viewBox="0 0 960 380" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:960px;">
        <defs>
            <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <linearGradient id="lineGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#3b82f6" stop-opacity="0.6"/><stop offset="100%" stop-color="#10b981" stop-opacity="0.6"/></linearGradient>
        </defs>

        <!-- Connection Lines -->
        <line x1="300" y1="140" x2="430" y2="180" stroke="url(#lineGrad)" stroke-width="2" stroke-dasharray="6,4" opacity="0.5">
            <animate attributeName="stroke-dashoffset" values="0;-20" dur="2s" repeatCount="indefinite"/>
        </line>
        <line x1="300" y1="240" x2="430" y2="200" stroke="url(#lineGrad)" stroke-width="2" stroke-dasharray="6,4" opacity="0.5">
            <animate attributeName="stroke-dashoffset" values="0;-20" dur="2s" repeatCount="indefinite"/>
        </line>
        <line x1="530" y1="180" x2="660" y2="120" stroke="url(#lineGrad)" stroke-width="2" stroke-dasharray="6,4" opacity="0.5">
            <animate attributeName="stroke-dashoffset" values="0;-20" dur="2s" repeatCount="indefinite"/>
        </line>
        <line x1="530" y1="200" x2="660" y2="200" stroke="url(#lineGrad)" stroke-width="2" stroke-dasharray="6,4" opacity="0.5">
            <animate attributeName="stroke-dashoffset" values="0;-20" dur="2s" repeatCount="indefinite"/>
        </line>
        <line x1="530" y1="200" x2="660" y2="280" stroke="url(#lineGrad)" stroke-width="2" stroke-dasharray="6,4" opacity="0.5">
            <animate attributeName="stroke-dashoffset" values="0;-20" dur="2s" repeatCount="indefinite"/>
        </line>

        <!-- Channel Labels on Mac mini side -->
        <text x="148" y="98" fill="#60a5fa" font-size="10" font-weight="600" font-family="system-ui">TG</text>
        <text x="172" y="98" fill="#6ee7b7" font-size="10" font-weight="600" font-family="system-ui">iM</text>
        <line x1="158" y1="102" x2="158" y2="115" stroke="#3b82f6" stroke-width="1.5" opacity="0.4"/>
        <line x1="180" y1="102" x2="180" y2="115" stroke="#10b981" stroke-width="1.5" opacity="0.4"/>
        <text x="152" y="218" fill="#6ee7b7" font-size="10" font-weight="600" font-family="system-ui">iM</text>
        <line x1="162" y1="222" x2="162" y2="232" stroke="#10b981" stroke-width="1.5" opacity="0.4"/>

        <!-- Mac mini Host Box -->
        <rect x="40" y="85" width="270" height="225" rx="16" fill="rgba(26,26,36,0.8)" stroke="rgba(139,92,246,0.3)" stroke-width="1.5"/>
        <text x="175" y="115" text-anchor="middle" fill="#9ca3af" font-size="11" font-weight="600" font-family="system-ui">üñ• MAC MINI (LOCAL)</text>

        <!-- Iva -->
        <rect x="65" y="125" width="220" height="50" rx="10" fill="rgba(139,92,246,0.1)" stroke="rgba(139,92,246,0.3)" stroke-width="1"/>
        <circle cx="85" cy="150" r="6" fill="${sc('iva')}" filter="url(#glow)">${anim('iva')}</circle>
        <text x="100" y="146" fill="#c4b5fd" font-size="13" font-weight="700" font-family="system-ui">ü¶πüèª‚Äç‚ôÄÔ∏è Iva</text>
        <text x="100" y="162" fill="#6b7280" font-size="10" font-family="system-ui">Opus 4.5 ¬∑ :18789</text>

        <!-- JOY -->
        <rect x="65" y="190" width="220" height="50" rx="10" fill="rgba(236,72,153,0.1)" stroke="rgba(236,72,153,0.3)" stroke-width="1"/>
        <circle cx="85" cy="215" r="6" fill="${sc('joy')}" filter="url(#glow)">${anim('joy')}</circle>
        <text x="100" y="211" fill="#f9a8d4" font-size="13" font-weight="700" font-family="system-ui">‚ú® JOY</text>
        <text x="100" y="227" fill="#6b7280" font-size="10" font-family="system-ui">Kimi K2.5 ¬∑ :18795</text>

        <!-- Internet Cloud -->
        <ellipse cx="480" cy="190" rx="60" ry="40" fill="rgba(59,130,246,0.05)" stroke="rgba(59,130,246,0.15)" stroke-width="1" stroke-dasharray="4,3"/>
        <text x="480" y="186" text-anchor="middle" fill="#4b5563" font-size="22" font-family="system-ui">‚òÅÔ∏è</text>
        <text x="480" y="206" text-anchor="middle" fill="#4b5563" font-size="10" font-weight="600" font-family="system-ui">INTERNET</text>

        <!-- Channel Labels on DO side -->
        <text x="780" y="78" fill="#60a5fa" font-size="10" font-weight="600" font-family="system-ui">TG</text>
        <line x1="788" y1="82" x2="788" y2="95" stroke="#3b82f6" stroke-width="1.5" opacity="0.4"/>
        <text x="780" y="168" fill="#60a5fa" font-size="10" font-weight="600" font-family="system-ui">TG</text>
        <line x1="788" y1="172" x2="788" y2="182" stroke="#3b82f6" stroke-width="1.5" opacity="0.4"/>
        <text x="768" y="248" fill="#a78bfa" font-size="10" font-weight="600" font-family="system-ui">DC</text>
        <text x="796" y="248" fill="#67e8f9" font-size="10" font-weight="600" font-family="system-ui">WC</text>
        <line x1="776" y1="252" x2="776" y2="262" stroke="#8b5cf6" stroke-width="1.5" opacity="0.4"/>
        <line x1="804" y1="252" x2="804" y2="262" stroke="#06b6d4" stroke-width="1.5" opacity="0.4"/>

        <!-- DO Droplet Host Box -->
        <rect x="650" y="85" width="270" height="225" rx="16" fill="rgba(26,26,36,0.8)" stroke="rgba(59,130,246,0.3)" stroke-width="1.5"/>
        <text x="785" y="115" text-anchor="middle" fill="#9ca3af" font-size="11" font-weight="600" font-family="system-ui">‚òÅÔ∏è DO DROPLET (137.184.6.184)</text>

        <!-- IVAN -->
        <rect x="675" y="125" width="220" height="50" rx="10" fill="rgba(59,130,246,0.1)" stroke="rgba(59,130,246,0.3)" stroke-width="1"/>
        <circle cx="695" cy="150" r="6" fill="${sc('ivan')}" filter="url(#glow)">${anim('ivan')}</circle>
        <text x="710" y="146" fill="#93c5fd" font-size="13" font-weight="700" font-family="system-ui">ü§ñ IVAN</text>
        <text x="710" y="162" fill="#6b7280" font-size="10" font-family="system-ui">Kimi K2.5 ¬∑ :18789</text>

        <!-- T.I.A. -->
        <rect x="675" y="190" width="220" height="50" rx="10" fill="rgba(245,158,11,0.1)" stroke="rgba(245,158,11,0.3)" stroke-width="1"/>
        <circle cx="695" cy="215" r="6" fill="${sc('tia')}" filter="url(#glow)">${anim('tia')}</circle>
        <text x="710" y="211" fill="#fbbf24" font-size="13" font-weight="700" font-family="system-ui">üè† T.I.A.</text>
        <text x="710" y="227" fill="#6b7280" font-size="10" font-family="system-ui">Kimi K2.5 ¬∑ :18790</text>

        <!-- ARVIS -->
        <rect x="675" y="255" width="220" height="50" rx="10" fill="rgba(6,182,212,0.1)" stroke="rgba(6,182,212,0.3)" stroke-width="1"/>
        <circle cx="695" cy="280" r="6" fill="${sc('arvis')}" filter="url(#glow)">${anim('arvis')}</circle>
        <text x="710" y="276" fill="#67e8f9" font-size="13" font-weight="700" font-family="system-ui">üîÆ ARVIS</text>
        <text x="710" y="292" fill="#6b7280" font-size="10" font-family="system-ui">Sonnet 4 ¬∑ :18794</text>

        <!-- Legend -->
        <circle cx="60" cy="345" r="4" fill="#10b981"/><text x="70" y="348" fill="#6b7280" font-size="10" font-family="system-ui">Online</text>
        <circle cx="130" cy="345" r="4" fill="#f59e0b"/><text x="140" y="348" fill="#6b7280" font-size="10" font-family="system-ui">Sleeping</text>
        <circle cx="210" cy="345" r="4" fill="#ef4444"/><text x="220" y="348" fill="#6b7280" font-size="10" font-family="system-ui">Offline</text>
        <rect x="290" y="341" width="20" height="2" fill="#3b82f6"/><text x="316" y="348" fill="#6b7280" font-size="10" font-family="system-ui">TG</text>
        <rect x="350" y="341" width="20" height="2" fill="#10b981"/><text x="376" y="348" fill="#6b7280" font-size="10" font-family="system-ui">iMessage</text>
        <rect x="440" y="341" width="20" height="2" fill="#8b5cf6"/><text x="466" y="348" fill="#6b7280" font-size="10" font-family="system-ui">Discord</text>
        <rect x="530" y="341" width="20" height="2" fill="#06b6d4"/><text x="556" y="348" fill="#6b7280" font-size="10" font-family="system-ui">Webchat</text>
    </svg>`;
}

// ===== CRON JOBS =====
function renderCronJobs() {
    const grid = document.getElementById('cron-grid');
    grid.innerHTML = '';
    const grouped = {};
    for (const job of cronJobs) {
        if (!grouped[job.bot]) grouped[job.bot] = [];
        grouped[job.bot].push(job);
    }
    for (const [botId, jobs] of Object.entries(grouped)) {
        const bot = BOTS[botId];
        const group = document.createElement('div');
        group.className = 'cron-group';
        group.innerHTML = `
            <div class="cron-group-header">
                <span>${bot.emoji}</span>
                <span class="cron-group-name" style="color:${bot.color}">${bot.name}</span>
            </div>
            ${jobs.map(j => `
                <div class="cron-item">
                    <div class="cron-item-left">
                        <span class="cron-name">${j.name}</span>
                        <span class="cron-schedule">${j.schedule}</span>
                    </div>
                    <div class="cron-item-right">
                        <span class="cron-next">‚è≠ ${j.next}</span>
                        <span class="cron-status-badge ${j.status}">${j.status}</span>
                    </div>
                </div>
            `).join('')}
        `;
        grid.appendChild(group);
    }
}

// ===== COMMAND CENTER =====
function renderCommandCenter() {
    const qa = document.getElementById('command-quick-actions');
    qa.innerHTML = '';
    for (const [id, bot] of Object.entries(BOTS)) {
        qa.innerHTML += `<button class="cmd-btn cmd-btn-status" data-action="status" data-bot="${id}">üì° ${bot.name}</button>`;
    }
    qa.innerHTML += '<span style="width:8px"></span>';
    for (const [id, bot] of Object.entries(BOTS)) {
        qa.innerHTML += `<button class="cmd-btn cmd-btn-restart" data-action="restart" data-bot="${id}">üîÑ ${bot.name}</button>`;
    }
    qa.querySelectorAll('.cmd-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const action = btn.dataset.action;
            const botId = btn.dataset.bot;
            const bot = BOTS[botId];
            const output = document.getElementById('command-output');
            if (action === 'status') {
                output.innerHTML = `<div style="color:var(--accent-green)">$ curl -s http://${bot.host}/</div><div style="margin-top:6px;">Checking ${bot.name} gateway status...</div><div style="margin-top:4px;color:var(--accent-cyan)">‚úì Gateway responding ‚Äî ${bot.name} is ${swarmState.agents[botId]?.status || 'unknown'}</div><div style="color:var(--text-muted);margin-top:2px;">Sessions: ${swarmState.agents[botId]?.sessions || 0} | Tokens today: ${formatTokens(swarmState.agents[botId]?.tokensToday || 0)}</div>`;
            } else if (action === 'restart') {
                output.innerHTML = `<div style="color:var(--accent-orange)">$ openclaw gateway restart</div><div style="margin-top:6px;">‚ö†Ô∏è Restarting ${bot.name}'s gateway...</div><div style="margin-top:4px;color:var(--accent-red)">DEMO ‚Äî actual restart requires CLI access on ${bot.hostLabel}</div>`;
            }
        });
    });
}

document.getElementById('command-send').addEventListener('click', sendCommand);
document.getElementById('command-input').addEventListener('keydown', (e) => { if (e.key === 'Enter') sendCommand(); });

function sendCommand() {
    const input = document.getElementById('command-input');
    const target = document.getElementById('command-target').value;
    const text = input.value.trim();
    if (!text) return;
    const bot = BOTS[target];
    const output = document.getElementById('command-output');
    output.innerHTML = `<div style="color:var(--accent-blue)">‚Üí ${bot.emoji} ${bot.name}: "${text}"</div><div style="margin-top:6px;color:var(--text-muted)">Command queued. In production this will POST to ${bot.host}/api/chat.</div>`;
    addActivityEntry(target, 'message', `üí¨ Command received: "${text}"`);
    input.value = '';
}

// ===== SWARM HEALTH =====
function updateSwarmHealth() {
    const el = document.getElementById('swarm-health');
    const statuses = Object.values(swarmState.agents).map(a => a.status);
    const offlineCount = statuses.filter(s => s === 'offline').length;
    el.className = 'swarm-health';
    if (offlineCount >= 2) {
        el.classList.add('critical');
        el.innerHTML = '<span class="health-dot critical"></span><span class="health-label">Swarm Critical</span>';
    } else if (offlineCount >= 1 || statuses.includes('sleeping')) {
        el.classList.add('degraded');
        el.innerHTML = '<span class="health-dot degraded"></span><span class="health-label">Swarm Degraded</span>';
    } else {
        el.innerHTML = '<span class="health-dot online"></span><span class="health-label">Swarm Healthy</span>';
    }
}

// ===== COLLAPSIBLE =====
document.querySelectorAll('.clickable[data-toggle]').forEach(header => {
    header.addEventListener('click', () => {
        const content = document.getElementById(header.dataset.toggle);
        const icon = header.querySelector('.collapse-icon');
        content.classList.toggle('collapsed');
        icon.style.transform = content.classList.contains('collapsed') ? 'rotate(-90deg)' : 'rotate(0)';
    });
});

// ===== TASK MODALS =====
const modalOverlay = document.getElementById('modal-overlay');
document.getElementById('new-task-btn').addEventListener('click', () => modalOverlay.classList.add('active'));
document.getElementById('modal-close').addEventListener('click', () => modalOverlay.classList.remove('active'));
document.getElementById('cancel-btn').addEventListener('click', () => modalOverlay.classList.remove('active'));
modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.classList.remove('active'); });

document.getElementById('task-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const newTask = {
        id: 't' + Date.now(),
        title: document.getElementById('task-title').value,
        description: document.getElementById('task-description').value,
        assignee: document.getElementById('task-assignee').value,
        priority: document.getElementById('task-priority-input').value,
        status: document.getElementById('task-status-input').value,
        tags: document.getElementById('task-tags-input').value.split(',').map(t => t.trim()).filter(Boolean),
        due: document.getElementById('task-due-input').value || null,
    };
    tasks.unshift(newTask);
    renderKanban();
    addActivityEntry(newTask.assignee, 'task', `üìã New task: "${newTask.title}"`);
    modalOverlay.classList.remove('active');
    document.getElementById('task-form').reset();
});

function showTaskDetail(task) {
    const overlay = document.getElementById('detail-modal-overlay');
    const bot = BOTS[task.assignee];
    document.getElementById('detail-title').textContent = task.title;
    document.getElementById('detail-body').innerHTML = `
        <div class="detail-field">
            <div class="detail-field-label">Description</div>
            <div class="detail-field-value">${task.description || 'No description'}</div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div class="detail-field">
                <div class="detail-field-label">Assignee</div>
                <div class="detail-field-value">${bot ? bot.emoji + ' ' + bot.name : 'Unassigned'}</div>
            </div>
            <div class="detail-field">
                <div class="detail-field-label">Priority</div>
                <div class="detail-field-value" style="text-transform:capitalize">${task.priority}</div>
            </div>
            <div class="detail-field">
                <div class="detail-field-label">Status</div>
                <div class="detail-field-value" style="text-transform:capitalize">${task.status.replace('-', ' ')}</div>
            </div>
            <div class="detail-field">
                <div class="detail-field-label">Due Date</div>
                <div class="detail-field-value">${task.due ? formatDate(task.due) : 'None'}</div>
            </div>
        </div>
        <div class="detail-field">
            <div class="detail-field-label">Tags</div>
            <div class="task-tags" style="margin-top:4px;">
                ${task.tags.map(t => `<span class="task-tag ${getTagClass(t)}">${t}</span>`).join('')}
            </div>
        </div>
    `;
    overlay.classList.add('active');
    document.getElementById('detail-delete-btn').onclick = () => {
        tasks = tasks.filter(t => t.id !== task.id);
        renderKanban();
        overlay.classList.remove('active');
        addActivityEntry(task.assignee || 'iva', 'task', `üóëÔ∏è Deleted: "${task.title}"`);
    };
}

document.getElementById('detail-modal-close').addEventListener('click', () => document.getElementById('detail-modal-overlay').classList.remove('active'));
document.getElementById('detail-close-btn').addEventListener('click', () => document.getElementById('detail-modal-overlay').classList.remove('active'));
document.getElementById('detail-modal-overlay').addEventListener('click', (e) => { if (e.target.id === 'detail-modal-overlay') e.target.classList.remove('active'); });

// ===== UTILITY =====
function formatTokens(n) {
    if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
    if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
    return n.toString();
}
function formatTimeAgo(iso) {
    const diff = Date.now() - new Date(iso).getTime();
    const mins = Math.floor(diff / 60000);
    if (mins < 1) return 'just now';
    if (mins < 60) return mins + 'm ago';
    const hrs = Math.floor(mins / 60);
    if (hrs < 24) return hrs + 'h ago';
    return Math.floor(hrs / 24) + 'd ago';
}
function formatDate(dateStr) {
    if (!dateStr) return '';
    const d = new Date(dateStr + 'T00:00:00');
    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}
function getDueClass(dateStr) {
    if (!dateStr) return '';
    const due = new Date(dateStr + 'T23:59:59');
    const diffDays = (due - new Date()) / 86400000;
    if (diffDays < 0) return 'overdue';
    if (diffDays < 2) return 'soon';
    return '';
}
function getTagClass(tag) {
    const map = { ars:'ars', dev:'dev', marketing:'marketing', infra:'infra', personal:'personal', crm:'crm', urgent:'urgent', voice:'voice' };
    return map[tag.toLowerCase()] || 'default';
}
function capitalize(s) { return s.replace(/(^|\s|-)\w/g, c => c.toUpperCase()); }

// ===== INIT =====
renderAll();
startAutoRefresh();
console.log('üéØ Mission Control v2 ‚Äî 5 agents online');
console.log('Agents:', Object.keys(BOTS).join(', '));
</script>
</body>
</html>
